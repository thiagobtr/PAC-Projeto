group_by(Interessado,Ano)%>%
filter(Ano==2013, Status=='Deferido',Real==TRUE )%>%
summarise(Valor2 = sum(Valor))%>%
arrange(desc(Valor2))%>%
group_by(Ano)%>%
filter(row_number()<=10)%>%
plot_ly(x = ~reorder(Interessado,Valor2) , y = ~Valor2, text = ~FormataValor(Valor2)
, hoverinfo = 'text')%>%
#add_trace( x = ~Interessado, y = ~Valor)%>%
#add_markers(color = ~Interessado) %>%
#add_text(text = ~UF)%>%
add_bars()%>%
layout(title = '2010 - Ano com Maior Operação de Credito <br>10 Maiores Valores',
xaxis = list(title = ''),
yaxis= list(title = ''))
OpCredito%>%
group_by(Ano,Status)%>%
filter(Status != 'Deferido',Real == TRUE)%>%
summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly(x = ~ factor(Ano) , y = ~Qtd,color= ~ Status
,text = ~FormataValor(ValorTotal))%>%
add_bars()%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
OpCredito%>%
group_by(Ano,Status)%>%
filter(Status != 'Deferido',Real == TRUE)%>%
summarise(ValorTotal = sum(Valor),Qtd = n())%>%
mutate(Perc = round(ValorTotal/sum(ValorTotal),2))%>%
plot_ly(x = ~ factor(Ano) , y = ~Perc,color= ~ Status
,text = ~FormataValor(ValorTotal))%>%
add_bars()%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
OpCredito%>%
group_by(Ano,Status)%>%
filter(Status != 'Deferido',Real == TRUE)%>%
summarise(ValorTotal = sum(Valor),Qtd = n())%>%
mutate(Perc = round(ValorTotal/sum(ValorTotal),2))%>%
plot_ly(x = ~ factor(Ano) , y = ~ValorTotal,color= ~ Status
,text = ~FormataValor(ValorTotal))%>%
add_boxplot()%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
OpCredito%>%
group_by(Ano)%>%
#filter(Status != 'Deferido',Real == TRUE)%>%
summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly(x = ~ factor(Ano) , y = ~ValorTotal
,text = ~FormataValor(ValorTotal))%>%
add_boxplot()%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
OpCredito%>%
group_by(Ano)%>%
#filter(Status != 'Deferido',Real == TRUE)%>%
summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly(x = ~ factor(Ano) , y = ~ValorTotal)%>%
add_boxplot()%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
OpCredito%>%
group_by(Ano)%>%
#filter(Status != 'Deferido',Real == TRUE)%>%
summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly(x = ~ factor(Ano) , y = ~ValorTotal
,type ='box')%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
OpCredito%>%
group_by(Ano)%>%
#filter(Status != 'Deferido',Real == TRUE)%>%
summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly( y = ~ValorTotal
,type ='box')%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
OpCredito%>%
group_by(Ano)%>%
#filter(Status != 'Deferido',Real == TRUE)%>%
summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly( y = ~ValorTotal
,type ='box'
,color =~Ano)%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
OpCredito%>%
group_by(Ano)%>%
#filter(Status != 'Deferido',Real == TRUE)%>%
summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly( y = ~ValorTotal
,color =~ Ano
,type ='box')%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
OpCredito%>%
group_by(Ano)%>%
#filter(Status != 'Deferido',Real == TRUE)%>%
plot_ly( y = ~ValorTotal
,color =~ Ano
,type ='box')%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
OpCredito%>%
group_by(Ano)%>%
#filter(Status != 'Deferido',Real == TRUE)%>%
summarise(ValorTotal = sum(Valor),Qtd = n())%>%
select(Ano,ValorTotal)
OpCredito%>%
group_by(Ano)%>%
#filter(Status != 'Deferido',Real == TRUE)%>%
#summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly( y = ~Valor
,color =~ Ano
,type ='box')%>%
layout(title = 'Creditos Nao Deferidos - Anual',
xaxis = list(
title = '',
tickfont = list(
size = 14)),
yaxis= list(
title = '',
tickfont = list(
size = 14)))
plot_ly(OpCredito, y = ~Valor
,color =~ Ano
,type ='box')
plot_ly(OpCredito, y = ~Valor
,color =~ factor(Ano)
,type ='box')
plot_ly(OpCredito, y = ~Valor
,color =~ factor(Ano)
,type ='boxplot')
plot_ly(ggplot2::diamonds, y = ~price, color = ~cut, type = "box")
plot_ly(OpCredito
,y = ~Valor
,color = ~factor(Ano)
,type ='box')
plot_ly(OpCredito
,y = ~Valor
,color = ~Status
,type ='box')
OpCredito%>%
filter(Status != 'Deferido',Real == TRUE)%>%
#summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly(OpCredito
,y = ~Valor
,color = ~Status
,type ='box')
OpCredito%>%
filter(Status != 'Deferido',Real == TRUE)%>%
#summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly(y = ~Valor
,color = ~Status
,type ='box')
OpCredito%>%
filter(Status != 'Deferido',Real == TRUE)%>%
#summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly(y = ~Valor
,color = ~factor(Ano)
,type ='box')%>%
OpCredito%>%
filter(Status != 'Deferido',Real == TRUE)%>%
#summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly(y = ~Valor
,color = ~factor(Ano)
,type ='box')
OpCredito%>%
filter(Status != 'Deferido',Real == TRUE)%>%
#summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly(y = ~Valor
,color = ~factor(Ano)
,type ='box')
OpCredito%>%
filter(Status != 'Deferido',Real == TRUE,Ano %in% list(2002,2003))%>%
#summarise(ValorTotal = sum(Valor),Qtd = n())%>%
plot_ly(y = ~Valor
,color = ~factor(Ano)
,type ='box')
print('teste')
version
print('teste')
version
install.packagec(c('ggplot2','lubridate','dplyr'))
install.packages(c('ggplot2','lubridate','dplyr'))
library('ggplot2')
library('dplyr')
library('lubridate')
library('stringr')
setwd('/media/sf_FormacaoCientistaDeDados/Portfolio/AnaliseBrasil')
pac <- data.frame(read.csv('Data/Pac_2018_12.csv',header=TRUE,sep=',',fileEncoding='latin1'
, stringsAsFactors =FALSE))
#arquivo Pac 2
pac_2014 <- data.frame(read.csv('Data/PAC_2014_10.csv',header=TRUE,sep=';',fileEncoding='latin1'
, stringsAsFactors =FALSE))
#Siglas e estados
sigla_uf<- data.frame(read.csv('Data/Estados_Siglas.txt',header=TRUE,sep = '\t',
stringsAsFactors = FALSE))
pac_2014$investimento_total<-ifelse(is.na(pac_2014$investimento_total),
ifelse(is.na(pac_2014$val_pos_2014),pac_2014$val_2011_2014,
pac_2014$val_pos_2014),pac_2014$investimento_total)
pac_2014$val_pos_2014=NULL
pac_2014$val_2011_2014=NULL
col_names<- colnames(pac)
names(pac_2014)<- col_names
pac_total<- rbind(pac,pac_2014)
remove(pac_2014)
pac_total$data_ciclo = as.Date(pac_total$dat_ciclo,"%d/%m/%Y")
pac_total$data_conclusao = as.Date(pac_total$dat_conclusao_revisada,"%d/%m/%Y")
pac_total$data_selecao = as.Date(pac_total$dat_selecao,"%d/%m/%Y")
pac_total$dat_ciclo = NULL
pac_total$dat_conclusao_revisada = NULL
pac_total$dat_selecao = NULL
pac_total$lat<-str_replace_all(pac_total$obra_latitude,"\\D","")
pac_total$lon<-str_replace_all(pac_total$obra_longitude,"\\D","")
pac_total<- select(pac_total,-c(obra_latitude,obra_longitude))
estagio_obras = tibble (
codigo = c(0,3,5,10,40,41,42,70,71,90,91),
descricao= c('Nao informado', 'A selecionar','Em contratação','Ação Preparatória',
'Em licitação de obra','Em licitação de projeto','Em execução de projeto',
'Em obras','Em execução','Concluído','Em operação'))
tipos_empr = tibble(
tipo <- c('Rodovias','Ferrovia','Porto', 'Hidrovia','Aeroporto'
,'Defesa','Comunicaçoes','Ciencia e Tecnologia'
,'Geração de Energia Elétrica','Transmissão de Energia Elétrica','Petróleo e Gás Natural'
,'Geologia e Mineração - Cprm','Marinha Mercante','Combustíveis Renováveis','Saneamento'
,'Água em áreas urbanas','Prevenção em áreas de risco','Pavimentação','Mobilidade Urbana'
,'Cidades Digitais','Cidades Históricas','Infraestrutura Turística','Olimpíadas'
,'Educação','Saúde','SUFRAMA','Casa da Mulher Brasileira','UBS','UPA','Creches e Pré Escolas'
,'Quadras Esportivas nas Escolas','Centro de Artes e Esportes Unificados'
,'Centro de Iniciação ao Esporte','MCMV','Urbanização de assentamentos precários'
,'Financiamento SBPE','Luz para Todos','Recursos Hídricos','Água em áreas urbanas','Estradas Vicinais'),
subeixo <-c(rep('Infraestrutura Logística',8),rep('Infraestrutura Energética',6),
rep('Infraestrutura Social e Urbana',24),'Infraestrutura Social e Urbana','Infraestrutura Logística'),
idn_digs <- c(1000,1001,1002,1003,1004,1006,1007,1008,2000,2001,2002,2003,2004,2005,3000,3000,
3001,3002,3003,3004,3005,3006,3007,3011,3012,3013,3009,4000,4001,4002,4003,4004,
4005,5000,5001,5002,6000,6002,6001,1005),.name_repair= ~ c('tipo','subeixo','idn_digs')
)
pac_total<-left_join(pac_total,estagio_obras,by = c("idn_estagio"= "codigo"))
# Criando novo dataframe com as informacaçoes do df pac_total2 e as variaveis "tipo_eixo" e "subeixo"
#do df tipos_empr
pac_total<- left_join(pac_total,tipos_empr,by = c("id_digs"="idn_digs"))
pac_total<- pac_total%>%
mutate(Qtd_uf= str_count(sig_uf,"[A-Z]")/2)%>%
select(idn_empreendimento:subeixo,Qtd_uf)
pac_total <- pac_total%>%filter(Qtd_uf==1)%>%
inner_join(sigla_uf,by=c("sig_uf"="SIGLA"))
pac_total<- pac_total%>%
select(idn_empreendimento:ESTADOS)%>%
mutate(
Regiao=case_when(
sig_uf %in% c('RS','PR','SC')~'Sul',
sig_uf %in% c('SP','RJ','ES','MG')~'Sudeste',
sig_uf %in% c('DF','MT','MS','GO')~'Centro-Oeste',
sig_uf %in% c('BA','PE','PB','CE','MA','RN','SE','AL','PI')~'Nordeste',
sig_uf %in% c('AM','TO','RR','AP','PA','AC','RO')~'Norte',
)
)
pac_total$idn_empreendimento=NULL
pac_total$id_digs=NULL
pac_total$idn_estagio=NULL
pac_total$Qtd_uf=NULL
pac_total_valor <- pac_total%>%filter(!is.na(investimento_total))
pac_total$investimento_total<- replace(pac_total$investimento_total,NA,0)
pac_total$investimento_total<-ifelse(is.na(pac_total$investimento_total)
,0,pac_total$investimento_total)
#Função para media mediana e desvio padrao
medidas<-function(valor){
tibble('media'=mean(valor),
'mediana'= median(valor),
'sd'= sd(valor))
}
moda <- function(valor){
calc<- table(valor)
names(calc) [calc == max(calc)]
}
medidas(pac_total_valor$investimento_total)
moda(pac_total_valor$investimento_total)
pac_total%>%
filter(investimento_total==0)%>%
tally()
grupo<-tapply(pac_total_valor$investimento_total,pac_total_valor$tipo,quantile )
View(grupo)
pac_total_valor%>% group_by(tipo)%>%
tally()
zvalor<- ave(pac_total_valor$investimento_total,pac_total_valor$tipo,scale)
zvalor<- ave(pac_total_valor$investimento_total,pac_total_valor$tipo,fun = scale)
pac_total_valor$valor_normal<- ave(pac_total_valor$investimento_total,pac_total_valor$tipo,fun = scale)
pac_total_valor$valor_normal<-NULL
pac_zscore<- pac_total_valor%>% group_by(tipo)%>%
select(investimento_total,tipo)%>%
mutate(zscore = scale(investimento_total))
View(pac_zscore)
pac_zscore <- pac_total_valor%>% group_by(tipo)%>%
select(investimento_total,tipo)%>%
mutate(zscore = scale(investimento_total),qtd=n())
View(pac_zscore%>%filter(zscore > 3 | zscore< -3))
pac_zscore <- pac_total_valor%>% group_by(tipo)%>%
select(investimento_total,tipo)%>%
mutate(zscore = scale(investimento_total),qtd=n())%>%
ungroup %>%
mutate(z_score_ungrouped = scale(investimento_total))
View(pac_zscore)
View(pac_total_valor%>% filter(tipo='Petróleo e Gás Natural'))
View(pac_total_valor%>% filter(tipo=='Petróleo e Gás Natural'))
pac_zscore <- pac_total_valor%>% group_by(tipo)%>%
select(titulo:Regiao)%>%
mutate(zscore = scale(investimento_total),qtd=n())%>%
ungroup %>%
mutate(z_score_ungrouped = scale(investimento_total))
View(pac_total_valor%>% filter(tipo=='Petróleo e Gás Natural')%>%
mutate(znomral= scale(investimento_total)))
pac_zscore%>%group_by(tipo)%>%
summarise(n=n(),
media = mean(investimento_total),
desvio = sd(investimento_total),
mediana = median(investimento_total),
media_zscore = mean(zscore),
desvio_zscore = sd(zscore),
mediana_zscore = median(zscore))%>%
mutate(cv = (desvio / media) *100,
cv_zscore = (desvio / media) *100)%>%
arrange(cv,desvio)
pac_tipos<- pac_zscore%>%group_by(tipo)%>%
summarise(n=n(),
media = mean(investimento_total),
desvio = sd(investimento_total),
mediana = median(investimento_total),
media_zscore = mean(zscore),
desvio_zscore = sd(zscore),
mediana_zscore = median(zscore))%>%
mutate(cv = (desvio / media) *100,
cv_zscore = (desvio / media) *100)%>%
arrange(cv,desvio)
View(pac_tipos)
pac_tipos<- pac_zscore%>%group_by(tipo)%>%
select(titulo :z_score_ungrouped)%>%
summarise(n=n(),
media = mean(investimento_total),
desvio = sd(investimento_total),
mediana = median(investimento_total),
media_zscore = mean(zscore),
desvio_zscore = sd(zscore),
mediana_zscore = median(zscore))%>%
mutate(cv = (desvio / media) *100,
cv_zscore = (desvio / media) *100)%>%
arrange(cv,desvio)
pac_tipos<- pac_zscore%>%group_by(tipo)%>%
select(titulo :z_score_ungrouped)%>%
summarise(n=n(),
media = mean(investimento_total),
desvio = sd(investimento_total),
mediana = median(investimento_total))%>%
mutate(cv = (desvio / media) *100)%>%
arrange(cv,desvio)
pac_tipos<- pac_zscore%>%group_by(tipo)%>%
select(titulo :z_score_ungrouped)%>%
mutate(n=n(),
media = mean(investimento_total),
desvio = sd(investimento_total),
mediana = median(investimento_total))%>%
mutate(cv = (desvio / media) *100)%>%
arrange(cv,desvio)
View(pac_tipos)
pac_tipos_uf<- pac_total_valor%>%group_by(tipo,sig_uf)%>%
summarise(n=n(),
media = mean(investimento_total),
desvio = sd(investimento_total),
mediana = median(investimento_total))%>%
mutate(cv = (desvio / media) *100)%>%
arrange(cv,desvio)
ggplot(data = pac_tipo_uf,aes(tipo,n))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(tipo,n))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(tipo,n))+
geom_bar(stat='identity')+
coord_flip()+
reorder(n)
ggplot(data = pac_tipos_uf,aes(reorder(tipo,n)))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(tipo,reorder(n)))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(tipo,n))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(tipo,reorder(tipo,-n))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(tipo,reorder(tipo,-n)))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(tipo,n))+
geom_bar(stat='identity')+
coord_flip()
pac_tipos_uf<- pac_total_valor%>%group_by(tipo,sig_uf)%>%
summarise(n=n(),
media = mean(investimento_total),
desvio = sd(investimento_total),
mediana = median(investimento_total))%>%
mutate(cv = (desvio / media) *100)%>%
arrange(n)
ggplot(data = pac_tipos_uf,aes(tipo,n))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(tipo,n))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(reorder(tipo,-n),y=n))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(reorder(tipo,n),y=n))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(reorder(uf,n),y=n))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(reorder(sig_uf,n),y=n))+
geom_bar(stat='identity')+
coord_flip()
ggplot(data = pac_tipos_uf,aes(reorder(tipo,n),y=n))+
geom_bar(stat='identity')+
coord_flip()
write.csv(pac_total_valor,'Pac_total_valor.csv')
medidas<-function(valor){
tibble('media'=mean(valor),
'mediana'= median(valor),
'sd'= sd(valor),
'IQR'=iIQR(valor))
}
medidas(pac_total_valor$investimento_total)
medidas<-function(valor){
tibble('media'=mean(valor),
'mediana'= median(valor),
'sd'= sd(valor),
'IQR'=IQR(valor))
}
medidas(pac_total_valor$investimento_total)
